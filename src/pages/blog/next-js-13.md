---
layout: "../../layouts/BlogPost.astro"
title: "Новая версия Next.js v13"
description: "Next.js\u00a0– это популярный фреймворк для создания универсальных приложений на\u00a0React, который помогает разработчикам ускорить разработку и\u00a0повысить производительность своих приложений."
pubDate: "March 03 2023"
---

## Основные улучшения:

### 1. Next.js Live:

Next.js Live&nbsp;&mdash; это новый инструмент для быстрой разработки, который позволяет разрабатывать и&nbsp;тестировать компоненты и&nbsp;страницы Next.js в&nbsp;режиме реального времени. Приложение позволяет использовать директиву live для отслеживания изменений и&nbsp;автоматической перезагрузки страницы.

```jsx
import { live } from "next/live";

function Counter() {
  const [count, setCount] = useState(0);

  return (
    <>
      <h1>{count}</h1>
      <button onClick={() => setCount(count + 1)}>Increment</button>
    </>
  );
}

export default live(Counter);
```

### 2. Incremental Static Regeneration (ISR)

Next.js 13&nbsp;представляет улучшенную версию ISR, которая позволяет генерировать статические страницы с&nbsp;более частыми обновлениями данных, например, каждую минуту или каждый час.

```jsx
import { getStaticProps } from 'next'

export async function getStaticProps() {
  const data = await fetch('https://example.com/api/data')
  const jsonData = await data.json()

  return {
    props: {
      data: jsonData,
    },
    revalidate: 60, // Обновление каждые 60 секунд
  }
```

### 3. Улучшенная поддержка TypeScript

С&nbsp;версии Next.js 13&nbsp;фреймворк имеет лучшую поддержку TypeScript, что позволяет разработчикам более эффективно использовать этот язык программирования при создании своих приложений.

### 4. Обновленный интерфейс командной строки

Next.js 13&nbsp;включает в&nbsp;себя обновленный интерфейс командной строки, который делает процесс разработки и&nbsp;отладки более удобным и&nbsp;эффективным.

### 5. Другие улучшения

- Улучшенная поддержка автозагрузки CSS для динамически загружаемых компонентов.
- Поддержка загрузки нескольких исходных файлов в&nbsp;next/image.
- Новая опция webpack5 для включения поддержки Webpack&nbsp;5.
- Обновленная версия swc для улучшения производительности компиляции.
- Улучшенная поддержка catch-all маршрутизации.
- Новая функциональность для getServerSideProps и&nbsp;getStaticProps для передачи параметров запроса.
- Улучшенная поддержка TypeScript и&nbsp;многое другое.

## Больше всего мне понравилось

В&nbsp;Next.js 13&nbsp;появилась новая опция конфигурации appDir, которая позволяет настроить путь к&nbsp;корневой директории приложения. Ранее эта директория всегда была установлена в&nbsp;корневую директорию проекта, но&nbsp;теперь с&nbsp;помощью опции appDir можно настроить ее&nbsp;на&nbsp;любую другую директорию.

По&nbsp;умолчанию значение опции appDir установлено на ./. Если вы&nbsp;хотите настроить путь к&nbsp;корневой директории на&nbsp;другую директорию, вам нужно установить опцию appDir в&nbsp;соответствующее значение.

Например, если ваша корневая директория приложения находится в&nbsp;директории ./src, вы&nbsp;можете установить опцию appDir следующим образом:

```js
// next.config.js
module.exports = {
  appDir: "src",
};
```

Теперь Next.js будет искать файлы и&nbsp;директории относительно директории src.

Эта новая опция может быть полезна, если вы&nbsp;хотите изменить структуру вашего приложения или переместить его в&nbsp;другую директорию, не&nbsp;изменяя пути к&nbsp;файлам и&nbsp;директориям, на&nbsp;которые ссылаются ваши компоненты и&nbsp;модули.

### Структура проекта

```
├── pages/
│   ├── index.js
│   ├── _app.js
│   ├── _document.js
│   └── _error.js
├── public/
│   ├── favicon.ico
│   └── vercel.svg
├── src/
│   ├── api/
│   │   └── index.js
│   ├── components/
│   │   └── Layout.js
│   ├── pages/
│   │   └── about.js
│   ├── styles/
│   │   ├── globals.css
│   │   └── index.css
│   └── utils/
│       └── helper.js
├── .env.local
├── next.config.js
├── package.json
└── README.md
```

Здесь в&nbsp;корневой папке проекта находятся файлы конфигурации, такие как next.config.js и .env.local, а&nbsp;также файл README.md с&nbsp;описанием проекта.

В&nbsp;папке pages находятся файлы, отвечающие за&nbsp;отображение страниц, включая \_app.js, \_document.js, \_error.js и&nbsp;файлы страниц.

Файл \_app.js является компонентом, который используется в&nbsp;качестве обертки для всех страниц приложения. В&nbsp;нем можно определить общие для всех страниц элементы интерфейса, такие как шапка, подвал и&nbsp;глобальные стили.

Файл \_document.js используется для настройки документа HTML, в&nbsp;котором будут отображаться страницы приложения. Здесь можно добавить метатеги, вставить сторонние скрипты и&nbsp;стили, а&nbsp;также настроить внешний вид страницы в&nbsp;зависимости от&nbsp;различных условий.

Файл \_error.js используется для отображения пользовательского интерфейса при возникновении ошибок на&nbsp;сервере или на&nbsp;клиенте.

В&nbsp;папке public находятся статические файлы, такие как изображения, иконки и&nbsp;другие файлы, которые будут доступны по&nbsp;URL-адресу example.com/filename.

В&nbsp;папке src находятся файлы и&nbsp;папки с&nbsp;кодом приложения. Папка api содержит файлы для взаимодействия с&nbsp;API, папка components содержит компоненты, которые могут быть использованы на&nbsp;страницах, а&nbsp;папка utils содержит вспомогательные функции.

В&nbsp;папке styles находятся глобальные стили приложения, а&nbsp;также стили, связанные с&nbsp;конкретными компонентами.

appDir позволяет определять обработчики для различных маршрутов и&nbsp;реализовывать свою собственную логику обработки запросов, что может значительно упростить структуру проекта и&nbsp;повысить его модульность. Вместо того, чтобы создавать множество страниц, вы&nbsp;можете создавать множество обработчиков для каждого маршрута и&nbsp;переиспользовать их&nbsp;на&nbsp;разных страницах.

Например, если вы&nbsp;хотите добавить обработчик для маршрута /api/hello, то&nbsp;в&nbsp;папке api вы&nbsp;можете создать файл hello.js, который будет содержать код для обработки этого маршрута. Код может выглядеть примерно так:

```js
export default function handler(req, res) {
  res.status(200).json({ message: "Hello, world!" });
}
```

Теперь, когда вы&nbsp;запустите приложение, обработчик для маршрута /api/hello будет доступен по&nbsp;адресу http://localhost:3000/api/hello.

Аналогично, вы&nbsp;можете создать обработчики для любых других маршрутов, используя файлы в&nbsp;папке api.

Также appDir позволяет определить дополнительные настройки для маршрутов, такие как middleware, cache, bodyParser и&nbsp;т.д. Эти опции можно определять непосредственно в&nbsp;файле обработчика маршрута.

Например, вы&nbsp;можете добавить middleware для маршрута /api/hello следующим образом:

```js
import { NextApiRequest, NextApiResponse } from "next";

function hello(req: NextApiRequest, res: NextApiResponse) {
  res.status(200).json({ message: "Hello, world!" });
}

export default function handler(req: NextApiRequest, res: NextApiResponse) {
  if (req.method === "GET") {
    console.log("This middleware is running!");
    hello(req, res);
  } else {
    res.status(400).json({ message: "Method not allowed" });
  }
}
```

Здесь мы&nbsp;добавляем middleware, который будет выполняться только при запросах методом GET на&nbsp;маршруте /api/hello.

Кроме того, appDir позволяет создавать файлы с&nbsp;маршрутами в&nbsp;папке pages/api, а&nbsp;не&nbsp;только в&nbsp;папке pages. Это позволяет отделить логику маршрутов от&nbsp;логики страниц и&nbsp;улучшить структуру проекта.

Например, вы&nbsp;можете создать файл pages/api/users/[id].js, который будет отвечать за&nbsp;обработку запросов к&nbsp;маршруту /api/users/:id. При этом вы&nbsp;можете использовать параметры маршрута внутри обработчика для получения нужных данных:

```js
export default function handler(req, res) {
  const { id } = req.query;
  // получаем данные пользователя с указанным id
  const user = getUserById(id);
  res.status(200).json(user);
}
```

Использование appDir позволяет создавать множество обработчиков маршрутов в&nbsp;отдельных файлах, определять дополнительные настройки для каждого маршрута, а&nbsp;также разделять логику маршрутов и&nbsp;страниц в&nbsp;проекте.

Вот пример структуры проекта с&nbsp;использованием appDir:

```
├── api
│   ├── hello.js
│   ├── posts.js
│   └── users
│       ├── index.js
│       └── [id].js
├── components
│   ├── footer.js
│   ├── header.js
│   └── layout.js
├── pages
│   ├── api
│   │   └── hello.js
│   ├── index.js
│   └── posts
│       ├── index.js
│       └── [id].js
├── public
│   ├── favicon.ico
│   ├── images
│   └── robots.txt
├── styles
│   ├── globals.css
│   ├── index.module.css
│   └── posts.module.css
├── .eslintrc.json
├── .gitignore
├── next.config.js
├── package-lock.json
├── package.json
└── README.md
```

Здесь мы&nbsp;создали папку api, в&nbsp;которой хранятся файлы с&nbsp;обработчиками маршрутов. Файлы с&nbsp;маршрутами можно создавать как непосредственно в&nbsp;папке api, так и&nbsp;во&nbsp;вложенных папках.

В&nbsp;папке components хранятся компоненты, которые используются на&nbsp;разных страницах. В&nbsp;папке pages хранятся страницы приложения, в&nbsp;том числе и&nbsp;файлы с&nbsp;маршрутами в&nbsp;папке api.

В&nbsp;папке public хранятся статические файлы, такие как изображения, favicon, robots.txt и&nbsp;т.д. В&nbsp;папке styles хранятся файлы со&nbsp;стилями приложения.

В&nbsp;файле next.config.js мы&nbsp;определяем опцию appDir, которая указывает на&nbsp;папку api как на&nbsp;директорию с&nbsp;обработчиками маршрутов. В&nbsp;файле package.json мы&nbsp;определяем зависимости и&nbsp;скрипты для запуска приложения.

Таким образом, использование appDir может значительно улучшить структуру проекта и&nbsp;сделать его более модульным, что облегчает его разработку и&nbsp;поддержку.
